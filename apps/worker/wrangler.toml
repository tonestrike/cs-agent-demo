name = "pestcall-worker"
main = "src/index.ts"
compatibility_date = "2024-10-22"
compatibility_flags = ["nodejs_compat"]

[vars]
CRM_PROVIDER = "d1"
# AGENT_MODEL options: "workers-ai" (default), "anthropic", "openrouter", "auto"
# - "auto" prioritizes: Anthropic > OpenRouter > Workers AI based on available API keys
# For Anthropic, set ANTHROPIC_API_KEY secret via: wrangler secret put ANTHROPIC_API_KEY
# For OpenRouter, set OPENROUTER_TOKEN secret via: wrangler secret put OPENROUTER_TOKEN
# Options: "workers-ai" (default), "anthropic", "openrouter"
# Currently using workers-ai since Anthropic account needs credits
# To switch to Anthropic: Set AGENT_MODEL = "anthropic" and add credits at console.anthropic.com
AGENT_MODEL = "workers-ai"
# Direct Anthropic API (bypass AI Gateway since it requires separate token)
ANTHROPIC_BASE_URL = "https://api.anthropic.com"
# AI_GATEWAY_ACCOUNT_ID = "197ac8ab6d5079d3faab60cea42eaa7e"
# AI_GATEWAY_ID = "cs-bot"
OPENROUTER_REFERER = "https://pestcall-worker.tonyvantur.workers.dev"
OPENROUTER_TITLE = "PestCall CS Agent"
OPENROUTER_BASE_URL = "https://openrouter.ai/api/v1"
REALTIMEKIT_ACCOUNT_ID = "197ac8ab6d5079d3faab60cea42eaa7e"
REALTIMEKIT_MEETING_ID = "bbb58ddd-1416-4812-aceb-7e078e61c78b"
REALTIMEKIT_APP_ID = "d8e165d3-6d87-483f-bc5a-55ff3a5bcaae"
REALTIMEKIT_API_TOKEN = "gF1yF_BuVanPdftA0yx-KZzEvdFjKudiN0r3efie"
REALTIMEKIT_PRESET_NAME = "group_call_guest"

[ai]
binding = "AI"

[[vectorize]]
binding = "KNOWLEDGE_VECTORS"
index_name = "pest-control-knowledge"

[[d1_databases]]
binding = "DB"
database_name = "pestcall_local"
database_id = "b3a818ac-cbb2-4981-b3f2-2ee61f9a0baa"
migrations_dir = "migrations"

[[durable_objects.bindings]]
name = "CONVERSATION_HUB"
class_name = "ConversationHub"

[[durable_objects.bindings]]
name = "CONVERSATION_SESSION_V2"
class_name = "ConversationSessionV2DO"

[[durable_objects.bindings]]
name = "VOICE_AGENT"
class_name = "VoiceAgentDO"

[[workflows]]
name = "pestcall-reschedule"
binding = "RESCHEDULE_WORKFLOW"
class_name = "RescheduleWorkflow"

[[workflows]]
name = "pestcall-verify"
binding = "VERIFY_WORKFLOW"
class_name = "VerificationWorkflow"

[[workflows]]
name = "pestcall-cancel"
binding = "CANCEL_WORKFLOW"
class_name = "CancelWorkflow"

[[migrations]]
tag = "v2"
new_classes = ["ConversationHub"]

[[migrations]]
tag = "v4"
new_classes = ["ConversationSessionV2DO"]

[[migrations]]
tag = "v7"
new_classes = ["VoiceAgentDO"]

[observability]

[observability.logs]
enabled = true
invocation_logs = true
