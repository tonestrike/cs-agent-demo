name = "pestcall-worker"
main = "src/index.ts"
compatibility_date = "2024-10-22"
compatibility_flags = ["nodejs_compat"]

[vars]
CRM_PROVIDER = "mock"
AGENT_MODEL = "workers-ai"
AI_GATEWAY_ACCOUNT_ID = "197ac8ab6d5079d3faab60cea42eaa7e"
AI_GATEWAY_ID = "cs-bot"
OPENROUTER_REFERER = "https://pestcall-worker.tonyvantur.workers.dev"
OPENROUTER_TITLE = "PestCall CS Agent"
OPENROUTER_BASE_URL = "https://openrouter.ai/api/v1"

[ai]
binding = "AI"

[[d1_databases]]
binding = "DB"
database_name = "pestcall_local"
database_id = "b3a818ac-cbb2-4981-b3f2-2ee61f9a0baa"
migrations_dir = "migrations"

[[durable_objects.bindings]]
name = "PestCallAgent"
class_name = "PestCallAgent"

[[durable_objects.bindings]]
name = "CONVERSATION_HUB"
class_name = "ConversationHub"

[[durable_objects.bindings]]
name = "CONVERSATION_SESSION"
class_name = "ConversationSession"

[[workflows]]
name = "pestcall-reschedule"
binding = "RESCHEDULE_WORKFLOW"
class_name = "RescheduleWorkflow"

[[workflows]]
name = "pestcall-verify"
binding = "VERIFY_WORKFLOW"
class_name = "VerificationWorkflow"

[[workflows]]
name = "pestcall-cancel"
binding = "CANCEL_WORKFLOW"
class_name = "CancelWorkflow"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["PestCallAgent"]

[[migrations]]
tag = "v2"
new_classes = ["ConversationHub"]

[[migrations]]
tag = "v3"
new_classes = ["ConversationSession"]

[observability]

[observability.logs]
enabled = true
invocation_logs = true
